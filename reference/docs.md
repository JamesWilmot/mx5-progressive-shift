https://www.reddit.com/r/arduino/comments/515vsd/my_progressive_shift_light_because_racecar/d79hvcd?st=isph81kr&sh=a4cba212

I've always wanted one of those Ecliptech Shift-i progressive shift lights, but they are kind of pricey, so I figured I'd try to put one together.
Step one was to figure out how to get an RPM signal in an acceptable format. That means we want a square wave, preferably 5v so we don't fry the arduino. My '91 Miata tach reads an "active low" 12v square wave from the ignition. That means there is a 12v signal on the wire, but when the ignitor fires, the circuit gets pulled low. So we have 12v with a bunch of 0v pulses. At idle ~900 RPM, I read 30Hz from the IG pin in the under hood diagnostic port. This means RPM = Hz * 30, which makes sense. RPM is a count over minutes, Hz is a count over seconds. So 30Hz * 60 seconds per minute = 1800 RPM. The miata's ignition system is a "wasted spark" system. I think this means the ignitor fires every time the cylinder is @ tdc. So that means we get a pulse twice as often as we should. So 30Hz * 60 seconds per minute*.5 = 30Hz * 30 = 900 RPM. Bingo. So if we want lights to start blinking at 6000 RPM, 6000RPM/30 = 200Hz, we tell the arduino to do it at 200Hz.
Now lets find a convenient place to grab the signal. This post on the back of the gauge cluster is about as convenient as one could ask for. Thanks Mazda :bow:
http://imgur.com/OuZkDS6.jpg
http://imgur.com/aAhPx0X.jpg
I still have the problem that this signal is 12v at this point. The arduino will not like that. I needed to make a circuit to assist with this. The idea behind this circuit is that the 12v signal from the car turns on an NPN transistor allowing the +5v signal from the arduino to flow through the transistor. The arduino only sees its own 5v, and only when the RPM signal turns on the transistor. The result should be a 5v version of the same waveform that the tach signal provides. The arduino should be happy with this circuit.
http://imgur.com/ON8BrsI.jpg
I used a function generator and O-Scope first to make sure a safe signal was produced, and it works as expected. My main concern was not so much about frying the arduino, I was pretty confident in that part of the circuit, I was more worried that the RPM signal would be pulled down thorugh the circuit. Luckily, the 3.3k resistor is plenty to keep that from happening.
Now we have the signal from the car, and we've translated it into something the arduino can accept, now we need to tell the arduino what to do with it. I decided to use some really neat LED's for this project, they are RGB LED's with an integrated WS2812b LED driver. You can get these already terminated on a 1 meter strip PCB for $8 on ebay, so they dirt cheap for what they are. They need 5v, and a data signal for control. Luckily, these LED's are popular and the arduino community has provided a library for us. Just search Adafruit Neopixel on GitHub and you should find it.
I like the idea of having a night mode to preserve night vision, so we'll need a button. Any momentary button will do. There are also many libraries for buttons, so take your pick, they all work the same. You could write your own, but button debouncing is a bit of an art, so be prepared to fiddle for a while to get it right. I went with a really lightweight library called Bounce2. You can find it on GitHub.
